<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chess</title>
	<style>
		body{margin:0;padding:0;background:#000}
		table{margin: auto;margin-top: 50vh;transform: translateY(-50%)}
		td{width:65px;height:65px;border:2px solid}
		.black{background:#433}
		.white{background:#FB1}
		.select{border-color:red}
		#pawn[data-player='2']{background-image: url('img/pawnB.png'); background-size: 100% 100%}
		#pawn[data-player='1']{background-image: url('img/pawnW.png'); background-size: 100% 100%}
		#rook[data-player='2']{background-image: url('img/rookB.png'); background-size: 100% 100%}
		#rook[data-player='1']{background-image: url('img/rookW.png'); background-size: 100% 100%}
		#bishop[data-player='2']{background-image: url('img/bishopB.png'); background-size: 100% 100%}
		#bishop[data-player='1']{background-image: url('img/bishopW.png'); background-size: 100% 100%}
		#knight[data-player='2']{background-image: url('img/knightB.png'); background-size: 100% 100%}
		#knight[data-player='1']{background-image: url('img/knightW.png'); background-size: 100% 100%}
		#queen[data-player='2']{background-image: url('img/queenB.png'); background-size: 100% 100%}
		#queen[data-player='1']{background-image: url('img/queenW.png'); background-size: 100% 100%}
		#king[data-player='2']{background-image: url('img/kingB.png'); background-size: 100% 100%}
		#king[data-player='1']{background-image: url('img/kingW.png'); background-size: 100% 100%}
	</style>
</head>
<body>
	<script>
		const chess = 
		{ 
			init : function(row, col)
			{	
				this.row = row
				this.col = col
				this.body = document.body
				this.tabHTML = document.createElement('table')
				this.tabJS = []
				this.tmp
				this.turn = 1
				this.pieces = ['pawn','rook','knight','bishop','queen','king','bishop','knight','rook']
				
				for(let i = this.row-1; i >= 0; i--)
				{
					const tr = document.createElement('tr')
					this.tabJS[i] = []
					for(let j = 0; j < this.col; j++)
					{
						const td = document.createElement('td')
						td.dataset.row = i
						td.dataset.column = j
						if((i+1) % 2 == 0)
						{
							if((j+1) % 2 == 0)
								td.classList.add('white')
							else
								td.classList.add('black')
						}
						else
						{
							if((j+1) % 2 != 0)
								td.classList.add('white')
							else
								td.classList.add('black')		
						}
						
						if(i == 1)
						{
							td.id = this.pieces[0]
							td.dataset.player = 1
						}
						
						if(i == this.row - 2)
						{
							td.id = this.pieces[0]
							td.dataset.player = 2
						}
						
						if(i == 0)
						{
							td.id = this.pieces[j+1]
							td.dataset.player = 1
						}
						
						if(i == this.row - 1)
						{
							td.id = this.pieces[j+1]
							td.dataset.player = 2
						}
						
						td.addEventListener('click', function()
						{
							if(chess.tmp != undefined)
							{
								chess.tmp.classList.remove('select')
								if(chess.tmp.id)
								{
									if(chess.tmp.getAttribute('data-player') == chess.turn)
										if(chess.pieces.includes(chess.tmp.id))
											chess.deplace(chess.tmp, this)
									chess.tmp = undefined
									return
								}
							}
							this.classList.add('select')
							chess.tmp = this
						})
						this.tabJS[i][j] = td
						tr.appendChild(td)
					}
					this.tabHTML.appendChild(tr)
				}
				this.body.appendChild(this.tabHTML)
			},
			
			deplace : function(oldPos, newPos)
			{
				const newPosRow = Number(newPos.getAttribute('data-row'))
				const newPosCol = Number(newPos.getAttribute('data-column'))
				const oldPosRow = Number(oldPos.getAttribute('data-row'))
				const oldPosCol = Number(oldPos.getAttribute('data-column'))
				const newPosPlayer = newPos.getAttribute('data-player')
				const player = this.turn
				const NegOrPos = this.turn == 1 ? -1 : 1
				const side = this.turn == 1 ? 1 : (this.row - 2)
				switch(oldPos.id)
				{
					case 'pawn' : 
					{
						//SI LA NOUVELLE CASE EST A UNE LIGNE DEVANT LA SELECTION ET ( (DANS LA MEME COLONNE ET VIDE) OU (DANS UNE COLONNE AVOISINANTE ET D'UNE PIECE ADVERSE) ).
						if((newPosRow + (1 * NegOrPos) == oldPosRow && ((newPosCol == oldPosCol && newPos.id == '') || (newPos.id != '' && (newPosCol + 1 == oldPosCol || newPosCol - 1 == oldPosCol) && newPosPlayer != player)))
						//OU SI LA NOUVELLE CASE EST A 2 LIGNE DEVANT LA SELECTION ET QUE LA SELECTION EST A LA POSITION INITIAL ET QUE LA NOUVELLE CASE EST VIDE ET QUE LA CASE ENTRE EST VIDE ET QUE ELLE EST DANS LA MEME COLONNE.
							|| newPosRow + (2 * NegOrPos) == oldPosRow && (oldPosRow == side) && this.tabJS[newPosRow + (1*NegOrPos)][newPosCol].id == '' && newPos.id == '' && (newPosCol == oldPosCol))
						{
							this.turn = (this.turn == 1) ? 2 : 1
							newPos.setAttribute('data-player', oldPos.getAttribute('data-player'))
							oldPos.removeAttribute('data-player')
							newPos.id = oldPos.id
							oldPos.removeAttribute('id')
						}
						break;
					}
					case 'knight' :
					{
						const posRowColDif = [1, -1, 3, -3]
						//SI LA DIFFERENCE ENTRE LA SOMME DU X ET DU Y DE LA SELECTION ET DU X ET DU Y DE LA NOUVELLE CASE EST UN DES NOMBRES DU TABLEAU
						if(posRowColDif.includes((oldPosCol + oldPosRow) - (newPosCol + newPosRow)) 
						//ET QUE (LA COLONNE DE LA SELECTION EST DIFFERENTE DE CELLE DE LA NOUVELLE CASE ET LA LIGNE DE LA SELECTION EST DIFFERENTE DE CELLE DE LA NOUVELLE CASE) 
							&& (oldPosCol !== newPosCol & oldPosRow !== newPosRow)
						//ET QUE LA COLONNE DE LA SELECTION SOIT A PAS PLUS DE 2 DE DIFFERENCE AVEC LA COLONNE DE LA NOUVELLE CASE ET QUE LA LIGNE DE LA SELECTION SOIT A PAS PLUS DE 2 DE DIFFERENCE AVEC LA LIGNE DE LA NOUVELLE CASE
							&& (oldPosCol - newPosCol < 3 && oldPosCol - newPosCol > -3) && (oldPosRow - newPosRow < 3 && oldPosRow - newPosRow > -3)
						//ET QUE LA NOUVELLE CASE NE CONTIENNE PAS UNE PIECE ALLIE
							&& newPosPlayer != player)
						{
							this.turn = (this.turn == 1) ? 2 : 1
							newPos.setAttribute('data-player', oldPos.getAttribute('data-player'))
							oldPos.removeAttribute('data-player')
							newPos.id = oldPos.id
							oldPos.removeAttribute('id')
						}
						break;
					}
				}
			}
		}
		
		chess.init(8,8)
	</script>
</body>
</html>