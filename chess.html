<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chess</title>
	<style>
		body{margin:0;padding:0}
		table{margin: auto;margin-top: 50vh;transform: translateY(-50%)}
		td{width:60px;height:60px;border:2px solid}
		.black{background:#433}
		.white{background:#FB1}
		.select{border-color:red}
		#pionB{background-image: url('pionB.png'); background-size: 100% 100%}
		#pionW{background-image: url('pionW.png'); background-size: 100% 100%}
	</style>
</head>
<body>
	<script>
		const chess = 
		{ 
			init : function(row, col)
			{	
				this.row = row
				this.col = col
				this.body = document.body
				this.tabHTML = document.createElement('table')
				this.tabJS = []
				this.tmp
				
				for(let i = this.row-1; i >= 0; i--)
				{
					const tr = document.createElement('tr')
					this.tabJS[i] = []
					for(let j = 0; j < this.col; j++)
					{
						const td = document.createElement('td')
						td.dataset.row = i
						td.dataset.column = j
						if((i+1) % 2 == 0)
						{
							if((j+1) % 2 == 0)
								td.classList.add('white')
							else
								td.classList.add('black')
						}
						else
						{
							if((j+1) % 2 != 0)
								td.classList.add('white')
							else
								td.classList.add('black')		
						}
						
						if(i == 1 )
						{
							td.id = 'pionW'
							td.dataset.player = 1
						}
						if(i == this.row - 2)
						{
							td.id = 'pionB'
							td.dataset.player = 2

						}
						
						td.addEventListener('click', function()
						{
							if(chess.tmp != undefined)
							{
								chess.tmp.classList.remove('select')
								if(chess.tmp.id)
								{
									chess.deplace(chess.tmp, this)
									chess.tmp = undefined
									return
								}
							}
							this.classList.add('select')
							chess.tmp = this
						})
						this.tabJS[i][j] = td
						tr.appendChild(td)
					}
					this.tabHTML.appendChild(tr)
				}
				this.body.appendChild(this.tabHTML)
			},
			
			deplace : function(oldPos, newPos)
			{
				const piece = ['pionW','pionB']
				if(piece.includes(oldPos.id))
				{
					const newPosRow = newPos.getAttribute('data-row')
					const newPosCol = newPos.getAttribute('data-column')
					const oldPosRow = oldPos.getAttribute('data-row')
					const oldPosCol = oldPos.getAttribute('data-column')
					const newPosPlayer = newPos.getAttribute('data-player')
					let player
					switch(oldPos.id)
					{
						case 'pionW' : 
						{
							player = 1
							if((Number(newPosRow) - 1 == Number(oldPosRow) && ((newPosCol == oldPosCol && newPos.id == '') || (newPos.id != '' && (Number(newPosCol) + 1 == Number(oldPosCol) || Number(newPosCol) - 1 == Number(oldPosCol)) && newPosPlayer != player))) || (Number(newPosRow) - 2 == Number(oldPosRow) && (Number(oldPosRow == 1)) && this.tabJS[Number(newPosRow)-1][Number(newPosCol)].id == '' && newPos.id == '' && (newPosCol == oldPosCol)))
							{	
								newPos.setAttribute('data-player', oldPos.getAttribute('data-player'))
								newPos.id = oldPos.id
								oldPos.id = ''
							}
							break;
						}
						case 'pionB' : 
						{
							player = 2
							if((Number(newPosRow) + 1 == Number(oldPosRow)&& ((newPosCol == oldPosCol && newPos.id == '' ) || (newPos.id !='' && (Number(newPosCol) + 1 == Number(oldPosCol) || Number(newPosCol) - 1 == Number(oldPosCol)) && newPosPlayer != player))) || (Number(newPosRow) + 2 == Number(oldPosRow) && (Number(oldPosRow == this.row - 2)) && this.tabJS[Number(newPosRow)+1][Number(newPosCol)].id == '' && newPos.id == '' && (newPosCol == oldPosCol)))
							{
								newPos.setAttribute('data-player', oldPos.getAttribute('data-player'))
								newPos.id = oldPos.id
								oldPos.id = ''
							}
							break;
						}
							
					}

				}
			}
		}
		
		chess.init(8,8)
	</script>
</body>
</html>