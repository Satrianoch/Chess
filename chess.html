<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chess</title>
	<style>
		body{margin:0;padding:0;background:#000}
		table{margin: auto;margin-top: 50vh;transform: translateY(-50%)}
		td{width:65px;height:65px;border:2px solid}
		.black{background:#433}
		.white{background:#FB1}
		.select{border-color:red}
		.highlight{background:#1CE}
		#pawn[data-player='-1']{background-image: url('img/pawnB.png'); background-size: 100% 100%}
		#pawn[data-player='1']{background-image: url('img/pawnW.png'); background-size: 100% 100%}
		#rook[data-player='-1']{background-image: url('img/rookB.png'); background-size: 100% 100%}
		#rook[data-player='1']{background-image: url('img/rookW.png'); background-size: 100% 100%}
		#bishop[data-player='-1']{background-image: url('img/bishopB.png'); background-size: 100% 100%}
		#bishop[data-player='1']{background-image: url('img/bishopW.png'); background-size: 100% 100%}
		#knight[data-player='-1']{background-image: url('img/knightB.png'); background-size: 100% 100%}
		#knight[data-player='1']{background-image: url('img/knightW.png'); background-size: 100% 100%}
		#queen[data-player='-1']{background-image: url('img/queenB.png'); background-size: 100% 100%}
		#queen[data-player='1']{background-image: url('img/queenW.png'); background-size: 100% 100%}
		#king[data-player='-1']{background-image: url('img/kingB.png'); background-size: 100% 100%}
		#king[data-player='1']{background-image: url('img/kingW.png'); background-size: 100% 100%}
	</style>
</head>
<body>
	<script>
		const chess = 
		{ 
			init : function(row, col)
			{	
				this.row = row
				this.col = col
				this.body = document.body
				this.tabHTML = document.createElement('table')
				this.tabJS = []
				this.selection
				this.turn = 1
				this.pieces = ['pawn','rook','knight','bishop','queen','king','bishop','knight','rook']
				
				for(let i = this.row-1; i >= 0; i--)
				{
					const tr = document.createElement('tr')
					this.tabJS[i] = []
					for(let j = 0; j < this.col; j++)
					{
						const td = document.createElement('td')
						td.dataset.row = i
						td.dataset.column = j
						if((i+1) % 2 == 0)
						{
							if((j+1) % 2 == 0)
								td.classList.add('white')
							else
								td.classList.add('black')
						}
						else
						{
							if((j+1) % 2 != 0)
								td.classList.add('white')
							else
								td.classList.add('black')		
						}
						
						if(i == 1)
						{
							td.id = this.pieces[0]
							td.dataset.player = 1
						}
						
						if(i == this.row - 2)
						{
							td.id = this.pieces[0]
							td.dataset.player = -1
						}
						
						if(i == 0)
						{
							td.id = this.pieces[j+1]
							td.dataset.player = 1
						}
						
						if(i == this.row - 1)
						{
							td.id = this.pieces[j+1]
							td.dataset.player = -1
						}
						
						td.addEventListener('click', function()
						{
							if(chess.selection == undefined)
								chess.selection = this
							
							if(this.id && this.dataset.player == chess.turn)
							{
								chess.clean()
								chess.selection = this
								chess.highlight(this)
								this.classList.add('select')
							}

							if(Array.from(this.classList).includes('highlight'))
							{
								chess.deplace(chess.selection, this)
								chess.clean()
							}	
						})
						
						this.tabJS[i][j] = td
						tr.appendChild(td)
					}
					this.tabHTML.appendChild(tr)
				}
				this.body.appendChild(this.tabHTML)
			},
			
			deplace : function(oldPos, newPos)
			{
				this.turn = (this.turn == 1) ? -1 : 1
				newPos.setAttribute('data-player', oldPos.getAttribute('data-player'))
				oldPos.removeAttribute('data-player')
				newPos.id = oldPos.id
				oldPos.removeAttribute('id')
			},
			
			highlight : function(selected)
			{
				const selectedRow = Number(selected.getAttribute('data-row'))
				const selectedCol = Number(selected.getAttribute('data-column'))
				const selectedPlayer = selected.getAttribute('data-player')
					switch(selected.id)
					{
						case 'pawn':
						{
						//HIGHLIGHT DE LA CASE DEVANT LE PION SI LA CASE EXISTE ET SI ELLE EST VIDE
							if((selectedRow+this.turn >= 0 || selectedRow+this.turn <= this.row) && !this.tabJS[selectedRow+this.turn][selectedCol].id)
								this.tabJS[selectedRow+this.turn][selectedCol].classList.add('highlight')
						//HIGHLIGHT DE LA DEUXIEME CASE DEVANT LE PION S'IL EST A L'EMPLACEMENT INITIAL ET QU'AUCUNE PIECE BLOQUE LE CHEMIN
							if((this.turn == 1 && selectedRow == 1 || this.turn == -1 && selectedRow == this.row - 2) && !this.tabJS[selectedRow+this.turn][selectedCol].id && !this.tabJS[selectedRow+(this.turn*2)][selectedCol].id)
								this.tabJS[selectedRow+(this.turn*2)][selectedCol].classList.add('highlight')
						//HIGHLIGHT DE LA CASE EN DIAGONAL SI ELLE EXISTE ET EST PRISE PAR UNE PIECE ADVERSE
							if((selectedRow+this.turn >= 0 || selectedRow+this.turn <= this.row) && (selectedCol+1 < this.col) && this.tabJS[selectedRow+this.turn][selectedCol+1].dataset.player == -this.turn)
								this.tabJS[selectedRow+this.turn][selectedCol+1].classList.add('highlight')
						//HIGHLIGHT DE LA CASE EN ANTIDIAGONAL SI ELLE EXISTE ET EST PRISE PAR UNE PIECE ADVERSE
							if((selectedRow+this.turn >= 0 || selectedRow+this.turn <= this.row) && (selectedCol-1 >= 0) && this.tabJS[selectedRow+this.turn][selectedCol-1].dataset.player == -this.turn)
								this.tabJS[selectedRow+this.turn][selectedCol-1].classList.add('highlight')
							break;
						}
						case 'king':
						{
						//TABLEAU CONTENANT LES DEPLACEMENTS D'UNE CASE DANS TOUTES LES DIRECTIONS
							const checkHighlight = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]
							let checkRow
							let checkCol
							for(let i = 0; i < checkHighlight.length; i++)
							{
								checkRow = selectedRow+checkHighlight[i][0]
								checkCol = selectedCol+checkHighlight[i][1]
								//HIGHLIGHT DE LA CASE SI ELLE NE DEBORDE PAS DU PLATEAU ET N'EST PAS ALLIE
								if((checkRow <= this.row-1 && checkRow >= 0 && checkCol <= this.col-1 && checkCol >= 0) && this.tabJS[checkRow][checkCol].dataset.player != this.turn)
									this.tabJS[checkRow][checkCol].classList.add('highlight')
							}
							break;
						}
						case 'knight':
						{
						//TABLEAU CONTENANT LES DEPLACEMENTS POSSIBLE DU CAVALIER
							const checkHighlight = [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]
							let checkRow
							let checkCol
							for(let i = 0; i < checkHighlight.length; i++)
							{
								checkRow = selectedRow+checkHighlight[i][0]
								checkCol = selectedCol+checkHighlight[i][1]
								//HIGHLIGHT DE LA CASE SI ELLE NE DEBORDE PAS DU PLATEAU ET N'EST PAS ALLIE
								if((checkRow <= this.row-1 && checkRow >= 0 && checkCol <= this.col-1 && checkCol >= 0) && this.tabJS[checkRow][checkCol].dataset.player != this.turn)
									this.tabJS[checkRow][checkCol].classList.add('highlight')
							}
							break;
						}
						case 'queen':
						case 'rook':
						case 'bishop':
						{
							let checkHighlight
							if(selected.id == 'queen')
							//TABLEAU CONTENANT LES DEPLACEMENTS D'UNE CASE DANS TOUTES LES DIRECTIONS
								checkHighlight = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]
							else if(selected.id == 'rook')
							//TABLEAU CONTENANT LES DEPLACEMENTS D'UNE CASE EN HORIZONTAL ET VERTICAL
								checkHighlight = [[1,0],[-1,0],[0,1],[0,-1]]
							else if(selected.id == 'bishop')
							//TABLEAU CONTENANT LES DEPLACEMENTS D'UNE CASE EN DIAGONAL
								checkHighlight = [[1,1],[-1,1],[1,-1],[-1,-1]]
							let checkRow
							let checkCol
							//POUR CHAQUE DIRECTIONS DU TABLEAU
							for(let i = 0; i < checkHighlight.length; i++)
							//PROGRESSE CASE PAR CASE TANT QU'ELLE NE DEBORDE PAR DU PLATEAU. SI UNE PIECE SE TROUVE SUR LA CASE, ARRETE LA BOUCLE
								for(let j = 1; selectedRow+(checkHighlight[i][0]*j) <= this.row-1 && selectedRow+(checkHighlight[i][0]*j) >= 0 && selectedCol+(checkHighlight[i][1]*j) <= this.col-1 && selectedCol+(checkHighlight[i][1]*j) >= 0; j++)
									{
										checkRow = selectedRow+(checkHighlight[i][0]*j)
										checkCol = selectedCol+(checkHighlight[i][1]*j)
									//HIGHLIGHT DE LA CASE SI ELLE NE DEBORDE PAS DU PLATEAU ET N'EST PAS ALLIE
										if((checkRow <= this.row-1 && checkRow >= 0 && checkCol <= this.col-1 && checkCol >= 0) && this.tabJS[checkRow][checkCol].dataset.player != this.turn)
											this.tabJS[checkRow][checkCol].classList.add('highlight')
									//ARRETE LA BOUCLE SI UNE PIECE EST SUR CETTE CASE 
										if(this.tabJS[checkRow][checkCol].id)
											break;
									}
						}
					}
			},
			
			clean : function()
			{
				this.selection.classList.remove('select')
				for(let i = 0; i < this.row; i++)
					for(let j = 0; j < this.col; j++)
						this.tabJS[i][j].classList.remove('highlight')
			}
		}
		
		chess.init(8,8)
	</script>
</body>
</html>